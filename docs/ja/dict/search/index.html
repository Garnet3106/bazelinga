<!DOCTYPE html>
<html lang="ja">
    <head>
        <link rel="icon" href="http://bazelinga.gant.work/docs/lib/img/baze/logo.svg">
        <link rel="stylesheet" href="../../../lib/dict/stylesheets/stylesheet.css">
        <meta charset="utf-8">
        <script src="http://bazelinga.gant.work/docs/lib/scripts/jquery-3.5.1.min.js"></script>
        <script src="../../../lib/dict/scripts/dictionary.js"></script>
        <script src="../../../lib/dict/scripts/interface.js"></script>
        <script>
            let dict = new Dictionary('ja');

            $(() => {
                $('#searchInput').on('input', () => {
                    dict.updateWordList();
                });

                let observer = new MutationObserver(event => {
                    let $target = $(event[0].target);

                    $target.animate({
                        width: $target.children().length * 40
                    }, 500);
                });

                let options = {
                    childList: true
                };

                $('.workarea-sidemenu-item').each((i, elem) => {
                    observer.observe(elem, options);
                });

                $('#rightMenuDocsIcon').on('click', () => {
                    if(dict.selectedItemIndex == -1) {
                        alert('単語を選択してください。');
                        return;
                    }

                    location.href = dict.getDocsURI();
                });

                $('#rightMenuShareIcon').on('click', () => {
                    $menuItem = $('#rightMenuShare');

                    // アイコンがすでに表示されている場合は閉じる
                    if($menuItem.children().length > 1) {
                        $menuItem.children('#rightMenuShareLink').remove();
                        $menuItem.children('#rightMenuShareTwitter').remove();
                        return;
                    }

                    if(dict.selectedItemIndex == -1) {
                        alert('単語を選択してください。');
                        return;
                    }

                    $linkShareIcon = $('<div class="workarea-sidemenu-item-icon" id="rightMenuShareLink"></div>');
                    $twitterShareIcon = $('<div class="workarea-sidemenu-item-icon" id="rightMenuShareTwitter"></div>');

                    $linkShareIcon.on('click', () => {
                        // ドキュメントURLをクリップボードにコピー
                        $clipboardText = $('<div id="clipboardText">' + dict.getDocsURI() + '</div>');
                        $('#body').append($clipboardText);
                        let $text = $('#clipboardText');
                        getSelection().selectAllChildren(document.getElementById('clipboardText'));
                        document.execCommand('copy');
                        $clipboardText.remove();

                        alert('クリップボードにコピーしました。');

                        // アイコンを削除する
                        $linkShareIcon.remove();
                        $twitterShareIcon.remove();
                    });

                    $twitterShareIcon.on('click', () => {
                        open(dict.getTwitterShareLink());

                        // アイコンを削除する
                        $linkShareIcon.remove();
                        $twitterShareIcon.remove();
                    });

                    $menuItem.append($linkShareIcon);
                    $menuItem.append($twitterShareIcon);
                });
            });
        </script>
        <title>把日辞書検索</title>
    </head>
    <body id="body">
        <div class="main" id="main">
            <div class="top" id="top">
                <div class="top-icons">
                    <img class="top-icons-item" id="topIconLogo" src="http://bazelinga.gant.work/docs/lib/img/baze/logo.svg">
                    <img class="top-icons-item" id="topIconTitle" src="http://bazelinga.gant.work/docs/lib/dict/img/ja/title.svg">
                </div>
                <div class="top-inputarea">
                    <input class="top-inputarea-input" id="searchInput" placeholder="検索キーワード" type="text">
                </div>
            </div>
            <div class="workarea">
                <div class="workarea-sidemenu" id="rightMenu">
                    <div class="workarea-sidemenu-item">
                    </div>
                    <div class="workarea-sidemenu-item">
                    </div>
                    <div class="workarea-sidemenu-item">
                    </div>
                </div>
                <div class="workarea-wordlist" id="wordList">
                    <div class="workarea-wordlist-guide" id="wordListGuide">
                        ここに検索結果が表示されます。
                    </div>
                </div>
                <div class="workarea-sidemenu" id="rightMenu">
                    <div class="workarea-sidemenu-item" id="rightMenuDocs">
                        <div class="workarea-sidemenu-item-icon" id="rightMenuDocsIcon">
                        </div>
                    </div>
                    <div class="workarea-sidemenu-item" id="rightMenuShare">
                        <div class="workarea-sidemenu-item-icon" id="rightMenuShareIcon">
                        </div>
                    </div>
                    <div class="workarea-sidemenu-item">
                    </div>
                    <div class="workarea-sidemenu-item">
                    </div>
                </div>
            </div>
            <div class="bottomlinks">
                <div class="bottomlinks-item">
                    Baze
                </div>
                <div class="bottomlinks-item">
                    English
                </div>
                <div class="bottomlinks-item">
                    日本語
                </div>
            </div>
        </div>
    </body>
</html>
